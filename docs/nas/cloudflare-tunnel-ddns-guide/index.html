<!doctype html><html lang=en data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://a4.zsl0621.cc/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://a4.zsl0621.cc/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://a4.zsl0621.cc/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/main.303ad1e76b9aec9f003f26dab6496c70040b06c73a698c9abaa7874ea605ff7d71b55aae2ff697f87bebb1aab6f375c67ab441ba34ef1d90a7b040ecd31a0298.css" integrity="sha512-MDrR52ua7J8APybatklscAQLBsc6aYyauqeHTqYF/31xtVquL/aX+Hvrsaq283XGerRBujTvHZCnsEDs0xoCmA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://a4.zsl0621.cc/docs/nas/cloudflare-tunnel-ddns-guide/><link rel=canonical href=https://a4.zsl0621.cc/docs/nas/cloudflare-tunnel-ddns-guide/><title>Cloudflare Tunnel — ZSL Docs</title>
<meta name=description content="了解如何利用 Cloudflare Tunnel 提供安全且便宜的方式來上外網，不需開啟本機端口。本文介紹選擇 Cloudflare Tunnel 的原因以及其優缺點。"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:title" content="Cloudflare Tunnel"><meta property="og:description" content="了解如何利用 Cloudflare Tunnel 提供安全且便宜的方式來上外網，不需開啟本機端口。本文介紹選擇 Cloudflare Tunnel 的原因以及其優缺點。"><meta property="og:type" content="article"><meta property="og:url" content="https://a4.zsl0621.cc/docs/nas/cloudflare-tunnel-ddns-guide/"><meta property="og:image" content="https://a4.zsl0621.cc/cover.png"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-05-08T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-08T00:00:00+00:00"><meta property="og:site_name" content="My Docs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://a4.zsl0621.cc/cover.png"><meta name=twitter:title content="Cloudflare Tunnel"><meta name=twitter:description content="了解如何利用 Cloudflare Tunnel 提供安全且便宜的方式來上外網，不需開啟本機端口。本文介紹選擇 Cloudflare Tunnel 的原因以及其優缺點。"><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://a4.zsl0621.cc/","name":"Zsl Docs","position":1},{"@type":"ListItem","item":"https://a4.zsl0621.cc/docs/","name":"Docs","position":2},{"@type":"ListItem","item":"https://a4.zsl0621.cc/docs/nas/","name":"Nas","position":3},{"@type":"ListItem","name":"Cloudflare Tunnel","position":4}]}</script><script defer data-domain=getdoks.org src=https://plausible.io/js/script.js></script></head><body class="single section docs" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand me-auto me-lg-3" href=/><span class=visually-hidden>ZSL Docs</span>
<svg class="doks-images-light-mode svg-inline svg-inline-custom svg-lightmode" height="100%" width="70" viewBox="0 0 682 190" fill="none"><path d="M.616001 187V.375992H88.424c21.163.0 38.912 3.925338 53.248 11.776008 14.507 7.68 25.429 18.5173 32.768 32.512C181.949 58.6587 185.704 75.0427 185.704 93.816c0 19.968-4.011 36.864-12.032 50.688-7.851 13.824-19.029 24.405-33.536 31.744C125.629 183.416 108.392 187 88.424 187H.616001zM38.248 157.304H81.512c22.357.0 38.912-5.71700000000001 49.664-17.152 10.923-11.435 16.384-27.136 16.384-47.104.0-21.8453-6.059-37.8027-18.176-47.872-11.947-10.24-27.904-15.36-47.872-15.36H38.248V157.304zM281.82 189.56C265.777 189.56 251.697 186.744 239.58 181.112 227.463 175.48 217.991 167.373 211.164 156.792 204.508 146.211 201.18 133.581 201.18 118.904S204.508 91.6827 211.164 81.272C217.82 70.6907 227.207 62.584 239.324 56.952c12.117-5.8027 26.283-8.704 42.496-8.704 16.213.0 30.379 2.816 42.496 8.448C336.433 62.328 345.82 70.4347 352.476 81.016 359.132 91.4267 362.46 104.056 362.46 118.904 362.46 133.411 359.132 145.955 352.476 156.536s-16.043 18.773-28.16 24.576C312.369 186.744 298.204 189.56 281.82 189.56zm0-28.16c13.824.0 24.661-3.84 32.512-11.52s11.776-18.005 11.776-30.976C326.108 105.763 322.183 95.4373 314.332 87.928 306.652 80.248 295.815 76.408 281.82 76.408c-13.824.0-24.661 3.84-32.512 11.52C241.628 95.608 237.788 105.933 237.788 118.904S241.628 142.2 249.308 149.88C257.159 157.56 267.996 161.4 281.82 161.4zM384.068 187V.375992H420.42V110.2l17.152-15.36L490.82 50.808h46.336l-64.768 53.504L539.46 187H494.148l-38.656-48.64L446.02 125.56l-25.6 20.736V187H384.068zm227.244 2.56c-22.699.0-40.107-4.096-52.224-12.288C546.971 169.08 540.485 157.987 539.632 143.992H575.216c1.024 15.36 13.397 23.04 37.12 23.04C622.747 167.032 630.939 165.667 636.912 162.936 642.885 160.035 645.872 155.512 645.872 149.368 645.872 144.76 644.763 141.347 642.544 139.128 640.325 136.739 636.571 134.947 631.28 133.752 625.989 132.557 618.651 131.533 609.264 130.68 593.733 129.144 581.189 127.011 571.632 124.28 562.075 121.379 555.077 117.283 550.64 111.992 546.373 106.701 544.24 99.6187 544.24 90.744 544.24 77.7733 550.128 67.448 561.904 59.768c11.947-7.68 28.501-11.52 49.664-11.52C631.195 48.248 646.811 52.0027 658.416 59.512 670.021 67.0213 676.421 77.688 677.616 91.512H643.056C642.373 84.344 639.131 79.0533 633.328 75.64 627.525 72.2267 620.187 70.52 611.312 70.52 601.925 70.52 594.245 71.9707 588.272 74.872 582.469 77.6027 579.568 81.9547 579.568 87.928 579.568 93.9013 582.469 97.912 588.272 99.96 594.075 102.008 603.547 103.715 616.688 105.08 632.389 106.445 645.019 108.579 654.576 111.48 664.133 114.211 671.045 118.392 675.312 124.024 679.579 129.485 681.712 137.165 681.712 147.064c0 12.8-5.803 23.125-17.408 30.976C652.869 185.72 635.205 189.56 611.312 189.56z" fill="#1d2d35"/></svg>
<svg class="doks-images-dark-mode svg-inline svg-inline-custom svg-darkmode" height="100%" width="70" viewBox="0 0 682 190" fill="none"><path d="M.616001 187V.375992H88.424c21.163.0 38.912 3.925338 53.248 11.776008 14.507 7.68 25.429 18.5173 32.768 32.512C181.949 58.6587 185.704 75.0427 185.704 93.816c0 19.968-4.011 36.864-12.032 50.688-7.851 13.824-19.029 24.405-33.536 31.744C125.629 183.416 108.392 187 88.424 187H.616001zM38.248 157.304H81.512c22.357.0 38.912-5.71700000000001 49.664-17.152 10.923-11.435 16.384-27.136 16.384-47.104.0-21.8453-6.059-37.8027-18.176-47.872-11.947-10.24-27.904-15.36-47.872-15.36H38.248V157.304zM281.82 189.56C265.777 189.56 251.697 186.744 239.58 181.112 227.463 175.48 217.991 167.373 211.164 156.792 204.508 146.211 201.18 133.581 201.18 118.904S204.508 91.6827 211.164 81.272C217.82 70.6907 227.207 62.584 239.324 56.952c12.117-5.8027 26.283-8.704 42.496-8.704 16.213.0 30.379 2.816 42.496 8.448C336.433 62.328 345.82 70.4347 352.476 81.016 359.132 91.4267 362.46 104.056 362.46 118.904 362.46 133.411 359.132 145.955 352.476 156.536s-16.043 18.773-28.16 24.576C312.369 186.744 298.204 189.56 281.82 189.56zm0-28.16c13.824.0 24.661-3.84 32.512-11.52s11.776-18.005 11.776-30.976C326.108 105.763 322.183 95.4373 314.332 87.928 306.652 80.248 295.815 76.408 281.82 76.408c-13.824.0-24.661 3.84-32.512 11.52C241.628 95.608 237.788 105.933 237.788 118.904S241.628 142.2 249.308 149.88C257.159 157.56 267.996 161.4 281.82 161.4zM384.068 187V.375992H420.42V110.2l17.152-15.36L490.82 50.808h46.336l-64.768 53.504L539.46 187H494.148l-38.656-48.64L446.02 125.56l-25.6 20.736V187H384.068zm227.244 2.56c-22.699.0-40.107-4.096-52.224-12.288C546.971 169.08 540.485 157.987 539.632 143.992H575.216c1.024 15.36 13.397 23.04 37.12 23.04C622.747 167.032 630.939 165.667 636.912 162.936 642.885 160.035 645.872 155.512 645.872 149.368 645.872 144.76 644.763 141.347 642.544 139.128 640.325 136.739 636.571 134.947 631.28 133.752 625.989 132.557 618.651 131.533 609.264 130.68 593.733 129.144 581.189 127.011 571.632 124.28 562.075 121.379 555.077 117.283 550.64 111.992 546.373 106.701 544.24 99.6187 544.24 90.744 544.24 77.7733 550.128 67.448 561.904 59.768c11.947-7.68 28.501-11.52 49.664-11.52C631.195 48.248 646.811 52.0027 658.416 59.512 670.021 67.0213 676.421 77.688 677.616 91.512H643.056C642.373 84.344 639.131 79.0533 633.328 75.64 627.525 72.2267 620.187 70.52 611.312 70.52 601.925 70.52 594.245 71.9707 588.272 74.872 582.469 77.6027 579.568 81.9547 579.568 87.928 579.568 93.9013 582.469 97.912 588.272 99.96 594.075 102.008 603.547 103.715 616.688 105.08 632.389 106.445 645.019 108.579 654.576 111.48 664.133 114.211 671.045 118.392 675.312 124.024 679.579 129.485 681.712 137.165 681.712 147.064c0 12.8-5.803 23.125-17.408 30.976C652.869 185.72 635.205 189.56 611.312 189.56z" fill="#fff"/></svg>
</a><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu"><svg class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Docs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details open><summary>Notes</summary><ul class="list-unstyled list-nested"><li><details open><summary>Programming</summary><ul class="list-unstyled list-nested"><li><a href=/docs/notes/programming/tmux/>tmux</a></li><li><a href=/docs/notes/programming/git-%E5%9F%BA%E7%A4%8E%E6%A6%82%E5%BF%B5%E8%88%87%E5%AF%A6%E6%88%B0%E6%8C%87%E4%BB%A4/>Git 基礎概念與實戰指令</a></li><li><a href=/docs/notes/programming/%E5%B8%B8%E7%94%A8linux%E6%8C%87%E4%BB%A4/>常用Linux指令</a></li><li><a href=/docs/notes/programming/docker/>常用Docker指令</a></li></ul></details></li><li><details open><summary>Others</summary><ul class="list-unstyled list-nested"><li><a href=/docs/notes/knowledge/webp-performance/>WebP圖片壓縮與解碼性能</a></li><li><a href=/docs/notes/knowledge/ffmpeg%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/>FFmpeg基礎知識</a></li><li><a href=/docs/notes/knowledge/exiftool/>ExifTool</a></li></ul></details></li></ul></details></li><li><details open><summary>NAS</summary><ul class="list-unstyled list-nested"><li><a href=/docs/nas/truenas-smb-security/>TrueNas SMB 簽名及加密設定</a></li><li><a href=/docs/nas/truenas-docker/>TrueNAS Docker</a></li><li class=active><a aria-current=page href=/docs/nas/cloudflare-tunnel-ddns-guide/>Cloudflare Tunnel</a></li><li><details open><summary>Hugo Blowfish</summary><ul class="list-unstyled list-nested"><li><a href=/docs/nas/blowfish/settings/>基礎設定</a></li><li><a href=/docs/nas/blowfish/advance-custom/>進階客製化</a></li><li><a href=/docs/nas/blowfish/bug-fix/>問題修復</a></li></ul></details></li></ul></details></li></ul></nav></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel><span class=visually-hidden>ZSL Docs</span><svg class="doks-images-light-mode svg-inline svg-inline-custom svg-lightmode" height="100%" width="60" viewBox="0 0 682 190" fill="none"><path d="M.616001 187V.375992H88.424c21.163.0 38.912 3.925338 53.248 11.776008 14.507 7.68 25.429 18.5173 32.768 32.512C181.949 58.6587 185.704 75.0427 185.704 93.816c0 19.968-4.011 36.864-12.032 50.688-7.851 13.824-19.029 24.405-33.536 31.744C125.629 183.416 108.392 187 88.424 187H.616001zM38.248 157.304H81.512c22.357.0 38.912-5.71700000000001 49.664-17.152 10.923-11.435 16.384-27.136 16.384-47.104.0-21.8453-6.059-37.8027-18.176-47.872-11.947-10.24-27.904-15.36-47.872-15.36H38.248V157.304zM281.82 189.56C265.777 189.56 251.697 186.744 239.58 181.112 227.463 175.48 217.991 167.373 211.164 156.792 204.508 146.211 201.18 133.581 201.18 118.904S204.508 91.6827 211.164 81.272C217.82 70.6907 227.207 62.584 239.324 56.952c12.117-5.8027 26.283-8.704 42.496-8.704 16.213.0 30.379 2.816 42.496 8.448C336.433 62.328 345.82 70.4347 352.476 81.016 359.132 91.4267 362.46 104.056 362.46 118.904 362.46 133.411 359.132 145.955 352.476 156.536s-16.043 18.773-28.16 24.576C312.369 186.744 298.204 189.56 281.82 189.56zm0-28.16c13.824.0 24.661-3.84 32.512-11.52s11.776-18.005 11.776-30.976C326.108 105.763 322.183 95.4373 314.332 87.928 306.652 80.248 295.815 76.408 281.82 76.408c-13.824.0-24.661 3.84-32.512 11.52C241.628 95.608 237.788 105.933 237.788 118.904S241.628 142.2 249.308 149.88C257.159 157.56 267.996 161.4 281.82 161.4zM384.068 187V.375992H420.42V110.2l17.152-15.36L490.82 50.808h46.336l-64.768 53.504L539.46 187H494.148l-38.656-48.64L446.02 125.56l-25.6 20.736V187H384.068zm227.244 2.56c-22.699.0-40.107-4.096-52.224-12.288C546.971 169.08 540.485 157.987 539.632 143.992H575.216c1.024 15.36 13.397 23.04 37.12 23.04C622.747 167.032 630.939 165.667 636.912 162.936 642.885 160.035 645.872 155.512 645.872 149.368 645.872 144.76 644.763 141.347 642.544 139.128 640.325 136.739 636.571 134.947 631.28 133.752 625.989 132.557 618.651 131.533 609.264 130.68 593.733 129.144 581.189 127.011 571.632 124.28 562.075 121.379 555.077 117.283 550.64 111.992 546.373 106.701 544.24 99.6187 544.24 90.744 544.24 77.7733 550.128 67.448 561.904 59.768c11.947-7.68 28.501-11.52 49.664-11.52C631.195 48.248 646.811 52.0027 658.416 59.512 670.021 67.0213 676.421 77.688 677.616 91.512H643.056C642.373 84.344 639.131 79.0533 633.328 75.64 627.525 72.2267 620.187 70.52 611.312 70.52 601.925 70.52 594.245 71.9707 588.272 74.872 582.469 77.6027 579.568 81.9547 579.568 87.928 579.568 93.9013 582.469 97.912 588.272 99.96 594.075 102.008 603.547 103.715 616.688 105.08 632.389 106.445 645.019 108.579 654.576 111.48 664.133 114.211 671.045 118.392 675.312 124.024 679.579 129.485 681.712 137.165 681.712 147.064c0 12.8-5.803 23.125-17.408 30.976C652.869 185.72 635.205 189.56 611.312 189.56z" fill="#1d2d35"/></svg><svg class="doks-images-dark-mode svg-inline svg-inline-custom svg-darkmode" height="100%" width="60" viewBox="0 0 682 190" fill="none"><path d="M.616001 187V.375992H88.424c21.163.0 38.912 3.925338 53.248 11.776008 14.507 7.68 25.429 18.5173 32.768 32.512C181.949 58.6587 185.704 75.0427 185.704 93.816c0 19.968-4.011 36.864-12.032 50.688-7.851 13.824-19.029 24.405-33.536 31.744C125.629 183.416 108.392 187 88.424 187H.616001zM38.248 157.304H81.512c22.357.0 38.912-5.71700000000001 49.664-17.152 10.923-11.435 16.384-27.136 16.384-47.104.0-21.8453-6.059-37.8027-18.176-47.872-11.947-10.24-27.904-15.36-47.872-15.36H38.248V157.304zM281.82 189.56C265.777 189.56 251.697 186.744 239.58 181.112 227.463 175.48 217.991 167.373 211.164 156.792 204.508 146.211 201.18 133.581 201.18 118.904S204.508 91.6827 211.164 81.272C217.82 70.6907 227.207 62.584 239.324 56.952c12.117-5.8027 26.283-8.704 42.496-8.704 16.213.0 30.379 2.816 42.496 8.448C336.433 62.328 345.82 70.4347 352.476 81.016 359.132 91.4267 362.46 104.056 362.46 118.904 362.46 133.411 359.132 145.955 352.476 156.536s-16.043 18.773-28.16 24.576C312.369 186.744 298.204 189.56 281.82 189.56zm0-28.16c13.824.0 24.661-3.84 32.512-11.52s11.776-18.005 11.776-30.976C326.108 105.763 322.183 95.4373 314.332 87.928 306.652 80.248 295.815 76.408 281.82 76.408c-13.824.0-24.661 3.84-32.512 11.52C241.628 95.608 237.788 105.933 237.788 118.904S241.628 142.2 249.308 149.88C257.159 157.56 267.996 161.4 281.82 161.4zM384.068 187V.375992H420.42V110.2l17.152-15.36L490.82 50.808h46.336l-64.768 53.504L539.46 187H494.148l-38.656-48.64L446.02 125.56l-25.6 20.736V187H384.068zm227.244 2.56c-22.699.0-40.107-4.096-52.224-12.288C546.971 169.08 540.485 157.987 539.632 143.992H575.216c1.024 15.36 13.397 23.04 37.12 23.04C622.747 167.032 630.939 165.667 636.912 162.936 642.885 160.035 645.872 155.512 645.872 149.368 645.872 144.76 644.763 141.347 642.544 139.128 640.325 136.739 636.571 134.947 631.28 133.752 625.989 132.557 618.651 131.533 609.264 130.68 593.733 129.144 581.189 127.011 571.632 124.28 562.075 121.379 555.077 117.283 550.64 111.992 546.373 106.701 544.24 99.6187 544.24 90.744 544.24 77.7733 550.128 67.448 561.904 59.768c11.947-7.68 28.501-11.52 49.664-11.52C631.195 48.248 646.811 52.0027 658.416 59.512 670.021 67.0213 676.421 77.688 677.616 91.512H643.056C642.373 84.344 639.131 79.0533 633.328 75.64 627.525 72.2267 620.187 70.52 611.312 70.52 601.925 70.52 594.245 71.9707 588.272 74.872 582.469 77.6027 579.568 81.9547 579.568 87.928 579.568 93.9013 582.469 97.912 588.272 99.96 594.075 102.008 603.547 103.715 616.688 105.08 632.389 106.445 645.019 108.579 654.576 111.48 664.133 114.211 671.045 118.392 675.312 124.024 679.579 129.485 681.712 137.165 681.712 147.064c0 12.8-5.803 23.125-17.408 30.976C652.869 185.72 635.205 189.56 611.312 189.56z" fill="#fff"/></svg></h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class="nav-link active" href=https://a4.zsl0621.cc/docs/intro/ aria-current=true>Docs</a></li><li class=nav-item><a target=blank class=nav-link href=https://www.zsl0621.cc/>Blog<svg class="ms-1 mb-1 icon icon-tabler icon-tabler-external-link" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 6H6A2 2 0 004 8v10a2 2 0 002 2h10a2 2 0 002-2v-6"/><path d="M11 13l9-9"/><path d="M15 4h5v5"/></svg></a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme"><svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg><svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class="nav-item d-none d-lg-flex py-1 col-auto"><div class="vr h-100 mx-2 text-muted"></div></li><li class=nav-item><a rel=me class="nav-link social-link" href="https://github.com/ZhenShuo2021?tab=repositories"><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li><li class=nav-item><a rel=me class="nav-link social-link" href=https://twitter.com/getdoks><svg class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg><small class="ms-2 visually-hidden">Twitter</small></a></li></ul></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details open><summary>Notes</summary><ul class="list-unstyled list-nested"><li><details open><summary>Programming</summary><ul class="list-unstyled list-nested"><li><a href=/docs/notes/programming/tmux/>tmux</a></li><li><a href=/docs/notes/programming/git-%E5%9F%BA%E7%A4%8E%E6%A6%82%E5%BF%B5%E8%88%87%E5%AF%A6%E6%88%B0%E6%8C%87%E4%BB%A4/>Git 基礎概念與實戰指令</a></li><li><a href=/docs/notes/programming/%E5%B8%B8%E7%94%A8linux%E6%8C%87%E4%BB%A4/>常用Linux指令</a></li><li><a href=/docs/notes/programming/docker/>常用Docker指令</a></li></ul></details></li><li><details open><summary>Others</summary><ul class="list-unstyled list-nested"><li><a href=/docs/notes/knowledge/webp-performance/>WebP圖片壓縮與解碼性能</a></li><li><a href=/docs/notes/knowledge/ffmpeg%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/>FFmpeg基礎知識</a></li><li><a href=/docs/notes/knowledge/exiftool/>ExifTool</a></li></ul></details></li></ul></details></li><li><details open><summary>NAS</summary><ul class="list-unstyled list-nested"><li><a href=/docs/nas/truenas-smb-security/>TrueNas SMB 簽名及加密設定</a></li><li><a href=/docs/nas/truenas-docker/>TrueNAS Docker</a></li><li class=active><a aria-current=page href=/docs/nas/cloudflare-tunnel-ddns-guide/>Cloudflare Tunnel</a></li><li><details open><summary>Hugo Blowfish</summary><ul class="list-unstyled list-nested"><li><a href=/docs/nas/blowfish/settings/>基礎設定</a></li><li><a href=/docs/nas/blowfish/advance-custom/>進階客製化</a></li><li><a href=/docs/nas/blowfish/bug-fix/>問題修復</a></li></ul></details></li></ul></details></li></ul></nav></div><div class="col container-fw d-lg-flex flex-lg-row justify-content-center mx-auto"><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#1-思路>1. 思路</a></li><li><a href=#11-優點>1.1. 優點</a></li><li><a href=#12-缺點>1.2. 缺點</a></li></ul><ul><li><a href=#11-設定-ddns>1.1. 設定 DDNS</a><ul><li><a href=#i-網域>I. 網域</a></li><li><a href=#ii-取得-cloudflare-api-token>II. 取得 Cloudflare API Token</a></li><li><a href=#iii-設定-ddns-服務>III. 設定 DDNS 服務</a></li></ul></li><li><a href=#12-設定-cloudflare-tunnel>1.2. 設定 Cloudflare Tunnel</a><ul><li><a href=#i-安裝-cloudflared>I. 安裝 Cloudflared</a></li><li><a href=#ii-設定-tunnel>II. 設定 Tunnel</a></li></ul></li></ul></nav></div><div class=feedback-links><h3>Contribute</h3><ul class=list-unstyled><li><a href=https://github.com/ZhenShuo2021/getdoks/issues>Bug Report</a></li></ul></div></nav><main class="docs-content col-lg-16 col-xl-12"><h1>Cloudflare Tunnel</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#1-思路>1. 思路</a></li><li><a href=#11-優點>1.1. 優點</a></li><li><a href=#12-缺點>1.2. 缺點</a></li></ul><ul><li><a href=#11-設定-ddns>1.1. 設定 DDNS</a><ul><li><a href=#i-網域>I. 網域</a></li><li><a href=#ii-取得-cloudflare-api-token>II. 取得 Cloudflare API Token</a></li><li><a href=#iii-設定-ddns-服務>III. 設定 DDNS 服務</a></li></ul></li><li><a href=#12-設定-cloudflare-tunnel>1.2. 設定 Cloudflare Tunnel</a><ul><li><a href=#i-安裝-cloudflared>I. 安裝 Cloudflared</a></li><li><a href=#ii-設定-tunnel>II. 設定 Tunnel</a></li></ul></li></ul></nav></div></details></nav><h1 id=利用-cloudflare-tunnel-和-ddns-無需開放端口實現安全外網訪問>利用 Cloudflare Tunnel 和 DDNS 無需開放端口實現安全外網訪問</h1><h2 id=1-思路>1. 思路<a href=#1-思路 class=anchor aria-hidden=true>#</a></h2><p>沒有思路，只是想找安全上外網的方式<a href="https://forum.gamer.com.tw/C.php?bsn=60030&amp;snA=604173#:~:text=21%3A32%20%E7%B7%A8%E8%BC%AF-,%E5%BE%88%E5%A4%9A%E6%96%B9%E6%B3%95,%3E%3E%E4%B8%AD%E8%BD%89%E4%BC%BA%E6%9C%8D%E5%99%A8%E9%A0%BB%E5%AF%AC%E6%9C%89%E9%99%90,-%E6%9C%80%E7%A9%A9%E5%AE%9A%3E%E7%AC%AC"><sup>[1]</sup></a><a href="https://www.mobile01.com/topicdetail.php?f=494&amp;t=6381761"><sup>[2]</sup></a>，直接使用port fowarding等同裸奔，使用DDNS還是得port foward，<a href="https://www.youtube.com/watch?v=_Qrd7oJMp6w">ZeroTier/TailScale</a>只能個人使用，用 VPN 路由器太舊，<a href="https://www.youtube.com/watch?v=ZfeZNbqIWTo">FRP</a>內網穿透需要租VPS做中轉，刪去法後 Cloudflared Tunnel (CT) 是最安全且便宜的方式。</p><p>這次使用註冊域名做 DDNS 解析不開 port 保證內網安全，其他需求使用 CNAME 經過 CT 加密傳輸，會有這種奇怪的方法其實是網路上只要用到 CT dashboard 的方法我都連不上<a href=https://medium.com/@zetavg/%E4%BD%BF%E7%94%A8-cloudflare-tunnel-%E4%BD%9C%E7%82%BA%E4%BD%8E%E6%88%90%E6%9C%AC%E7%9A%84-ngrok-%E6%9B%BF%E4%BB%A3%E5%93%81-6b0aaef97557><sup>[3]</sup></a><a href=https://www.sakamoto.blog/cloudflare-tunnel/><sup>[4]</sup></a>，可能還是得開 port，東拼西湊就變成這樣了。</p><p>關於 DDNS，不要用 Cloudflare API，會用到自己想死。</p><h2 id=11-優點>1.1. 優點<a href=#11-優點 class=anchor aria-hidden=true>#</a></h2><ul><li>不用租 VPS 伺服器，最便宜域名 5 usd per year。</li><li>Cloudflared 的 reverse proxy 幫你擋DDoS，傳輸加密，隱藏主機 IP，免開本機 port。</li><li>如果域名在 Cloudflared 買還可以自動配好憑證，也不用每三個月自動更新。</li><li>每個 port 的服務使用個別配置的<strong>子域名</strong>進入。</li></ul><h2 id=12-缺點>1.2. 缺點<a href=#12-缺點 class=anchor aria-hidden=true>#</a></h2><ul><li>原始域名拿去更新 DDNS 無法使用，但可以使用 www 當 CNAME 有八成像。</li><li>若要使用原始域名可以在路由器開啟 port forwarding。<div class="callout callout-note d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg class="outline/info-circle svg-inline callout-icon me-2 mb-3" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-title><p>Note</p></div><div class=callout-body><p>[已解決] 使用 tailscale 作內網穿透可存取包含 http / SMB / docker 等服務。</p></div></div></div></li><li><del>[還沒試過] Cloudflare 只支援80/443 port，SMB等服務無法使用 proxy，只能直接開 port</del></li></ul><h1 id=2-開始>2. 開始</h1><p>這次服務需要用到DDNS以及Cloudflare Tunnel，所以教學也分為兩部分。本次教學需要更改的部分在指令中都會用&lt;>框起，設定如下，請更改為自己的環境，：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><pre tabindex=0><code>USER_NAME=leo # DIR name in ubuntu-server
TUNNEL_NAME=ubuntu-server
DomainName=leo-photos.uk
ServerLocalIP=192.168.50.100
PortPhotoprism=2342
PortImmich=2283</code></pre></figure></div><h2 id=11-設定-ddns>1.1. 設定 DDNS<a href=#11-設定-ddns class=anchor aria-hidden=true>#</a></h2><h3 id=i-網域>I. 網域<a href=#i-網域 class=anchor aria-hidden=true>#</a></h3><ol><li>購買網域：我是在 Cloudflare Domain Registration 購買的。注意之後需要 CNAME，因此域名盡量簡短，服務名稱可以在 CNAME 內完成。若是在其他網域商買的可以使用 change nameserver 功能，<strong>注意 no-ip 無法轉移</strong>。</li><li>新增 DNS：到 Cloudflare 主頁選擇 <code>購買的網域 > 左側欄位的 DNS > DNS Records > Add record</code> ，分別填入 <code>Type A，leo-photos.uk，1.2.3.4</code> （1.2.3.4 可以隨便填，下一步動態更新 DNS 會自動修正）。</li><li>（選用）啟用 proxy 會讓該 IP 經過 Cloudflare 伺服器以隱藏原始 IP。</li></ol><h3 id=ii-取得-cloudflare-api-token>II. 取得 Cloudflare API Token<a href=#ii-取得-cloudflare-api-token class=anchor aria-hidden=true>#</a></h3><ol><li>到 Cloudflare 主頁點擊 <code>右上角頭像 > My Profile > API Tokens > Create Token</code>。</li><li>選擇 <code>Edit zone DNS</code> ，Zone Resources選擇你的域名，點擊下一步進入Summary，再點擊下一步。</li><li>生成的Token很長等一下會用到，下面指令可以測試Token是否可用，運作正常會顯示 <code>This API Token is valid and active</code> 。</li></ol><h3 id=iii-設定-ddns-服務>III. 設定 DDNS 服務<a href=#iii-設定-ddns-服務 class=anchor aria-hidden=true>#</a></h3><p>使用 <a href=https://github.com/jeessy2/ddns-go>DDNS-GO</a> 自動獲取 IP （<a href=https://zhuanlan.zhihu.com/p/670026839>圖文教學</a>）</p><ol><li>部署 DDNS-GO：<div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>docker run -d --name ddns-go --restart<span class=o>=</span>always -p 9876:9876 -v /opt/ddns-go:/root jeessy/ddns-go</span></span></code></pre></div></figure></div></li><li>進入 <code>http://&lt;192.168.50.100>:9876</code>，選擇Cloudflare，貼上剛剛的Token，Domains填申請的域名，設定帳號密碼後儲存。</li></ol><h2 id=12-設定-cloudflare-tunnel>1.2. 設定 Cloudflare Tunnel<a href=#12-設定-cloudflare-tunnel class=anchor aria-hidden=true>#</a></h2><p>依照<a href=https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/create-local-tunnel>官方教學</a>輸入指令，注意到第四步我們會先跑去設定 <code>run as service</code> ，以下為完整步驟。以Linux為例：</p><h3 id=i-安裝-cloudflared>I. 安裝 Cloudflared<a href=#i-安裝-cloudflared class=anchor aria-hidden=true>#</a></h3><ol><li>新增 GPG key、新增 Cloudflare apt repo、更新並安裝<div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo mkdir -p --mode<span class=o>=</span><span class=m>0755</span> /usr/share/keyrings
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl -fsSL https://pkg.cloudflare.com/cloudflare-main.gpg <span class=p>|</span> sudo tee /usr/share/keyrings/cloudflare-main.gpg &gt;/dev/null
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared </span><span class=k>$(</span>lsb_release -cs<span class=k>)</span><span class=s2> main&#34;</span> <span class=p>|</span> sudo tee /etc/apt/sources.list.d/cloudflared.list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo apt-get update <span class=o>&amp;&amp;</span> sudo apt-get install cloudflared</span></span></code></pre></div></figure></div></li></ol><h3 id=ii-設定-tunnel>II. 設定 Tunnel<a href=#ii-設定-tunnel class=anchor aria-hidden=true>#</a></h3><ol><li><p>登入 Cloudflared，進入顯示的網址登入，此步驟 Cloudflare 會自動新增給 Tunnel 用的 API Token：</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cloudflared tunnel login</span></span></code></pre></div></figure></div></li><li><p>建立 Tunnel：</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cloudflared tunnel create &lt;ubuntu-server&gt;</span></span></code></pre></div></figure></div></li><li><p>列出 Tunnel UUID：</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cloudflared tunnel list</span></span></code></pre></div></figure></div></li><li><p>建立 config 檔案
在 <code>/home/leo</code> 中使用 <code>nano</code> 建立一個 <code>config.yml</code> 檔案，以下方式二擇一，若只有一個port可用以下形式：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://&lt;localhost:2283&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tunnel</span><span class=p>:</span><span class=w> </span><span class=l>&lt;Tunnel-UUID&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>credentials-file</span><span class=p>:</span><span class=w> </span><span class=l>/home/leo/.cloudflared/&lt;Tunnel-UUID&gt;.json</span></span></span></code></pre></div></figure></div><p>多 port 可以用以下<a href=https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/local-management/configuration-file/>格式</a>，可指定 port 對應不同 CNAME：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>tunnel</span><span class=p>:</span><span class=w> </span><span class=l>&lt;Tunnel-UUID&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>credentials-file</span><span class=p>:</span><span class=w> </span><span class=l>/home/leo/.cloudflared/&lt;Tunnel-UUID&gt;.json    </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ingress</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>&lt;immich.leo-photos.uk&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	  </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>http://&lt;localhost:2283&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>&lt;photoprism.leo-photos.uk&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	  </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>http://&lt;localhost:2342&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>http_status:404</span></span></span></code></pre></div></figure></div><p><code>/etc/cloudflared</code>中也要一份一模一樣的檔案，可使用cp指令直接複製一份到目標資料夾：</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo cp ~/.cloudflared/config.yml /etc/cloudflared/config.yml</span></span></code></pre></div></figure></div></li><li><p>設定 <a href=https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/local-management/as-a-service/linux/>run as service</a> 在背景中運行 Tunnel</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo cloudflared service install
</span></span><span class=line><span class=cl>sudo systemctl start cloudflared
</span></span><span class=line><span class=cl>sudo systemctl status cloudflared
</span></span><span class=line><span class=cl>sudo systemctl restart cloudflared</span></span></code></pre></div></figure></div></li><li><p>註冊 route dns
有幾個 CNAME 就要註冊幾個 route dns。<strong>route dns只能到官網刪除</strong>，本地無法刪除</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># &lt;Tunnel-Name&gt; / &lt;hostname&gt;</span>
</span></span><span class=line><span class=cl>cloudflared tunnel route dns &lt;ubuntu-server&gt; &lt;immich.leo-photos.uk&gt;</span></span></code></pre></div></figure></div></li><li><p>大功告成</p><p>啟動 Tunnel</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># cloudflared tunnel run &lt;ubuntu-server&gt;</span>
</span></span><span class=line><span class=cl>sudo systemctl restart cloudflared</span></span></code></pre></div></figure></div></li></ol><h1 id=3-額外的選項>3. 額外的選項</h1><p>Cloudflare 免費版也送了很多安全選項
點選購買的網域：</p><ol><li>Quick Start Guide勾一勾</li><li>DNS > DNS Settings > DNSSEC</li><li>SSL/TLS > Overview > encryption Full (strict)</li><li>SSL/TLS > Edge Certificates</li><li>Security: WAF templete: mTLS-enforced authentication</li><li>Security: WAF Zone lockdown Country not equal Taiwan</li><li>Security: Bots <a href=https://www.cnblogs.com/louqianzhu/p/17446080.html>但是聽說有問題</a></li><li>Security: DDoS > Block, High</li><li>Security: Security Level, Browser Integrity Check</li><li>Speed: Optimization HTTP/2 to Origin off, HTTP/3 (with QUIC)</li><li>Rules: 上次動了直接連不了</li><li>Network: WebSockets off, gRPC off, Onion Routing off</li><li>Zero Trust > Settings > Network > Proxy</li></ol><h1 id=4-notes>4. Notes</h1><ol><li><p>網路上使用dashboard的方法我都無法成功，所以才用CLI方式建立。</p></li><li><p>網路上很多"都變成“，複製貼上時請小心。</p></li><li><p>A record=ipv4, AAAA record=ipv6。</p></li><li><p>查詢後發現使用no-ip無法轉移nameserver到Cloudflare上。</p></li><li><p>可使用以下指令管理Cloudflared</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo systemctl status cloudflared
</span></span><span class=line><span class=cl>sudo systemctl start cloudflared
</span></span><span class=line><span class=cl>sudo systemctl restart cloudflared
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> cloudflared</span></span></code></pre></div></figure></div></li><li><p><strong>移除Cloudflared</strong></p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 依序移除service, auto start, config, cloudflared</span>
</span></span><span class=line><span class=cl>sudo cloudflared service uninstall
</span></span><span class=line><span class=cl>sudo rm /etc/systemd/system/cloudflared.service
</span></span><span class=line><span class=cl>sudo rm /etc/cloudflared/config.yml
</span></span><span class=line><span class=cl>sudo rm -r ~/.cloudflared
</span></span><span class=line><span class=cl>sudo apt-get remove cloudflared</span></span></code></pre></div></figure></div></li><li><p><strong>Useful commands</strong></p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cloudflared tunnel delete &lt;Tunnel-UUID or NAME&gt;</span></span></code></pre></div></figure></div></li></ol><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=edit-page><a href=https://github.com/gethyas/getdoks.org/blob/main/content//docs/nas/cloudflare-tunnel-ddns-guide.md><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
Edit this page on GitHub</a></div></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/docs/nas/truenas-docker/ class="stretched-link text-reset text-decoration-none">TrueNAS Docker</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/docs/nas/blowfish/settings/ class="stretched-link text-reset text-decoration-none">基礎設定</a></div><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div><span id=docsearch-lvl0 hidden>NAS</span></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=https://gethyas.com/privacy/>Privacy Policy</a></li><li class=list-inline-item><a class=text-muted href=https://gethyas.com/terms/>Terms of Service</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Brought to you by <a class=text-muted href=https://gethyas.com/>Hyas</a></li></ul></div></div></div></footer><script async src=/js/bootstrap.c673c84373e66019f7895efc74b3b3b940071832aaa8a85e73218087d535e71b.js integrity="sha256-xnPIQ3PmYBn3iV78dLOzuUAHGDKqqKhecyGAh9U15xs="></script><script async src=/js/app.47c46b2840c2453168bad1c3330a87ccfe7430ff205663d3aca213c6293a838a.js integrity="sha256-R8RrKEDCRTFoutHDMwqHzP50MP8gVmPTrKITxik6g4o="></script><script async src=/js/flexsearch.b6f80717bc68cd38b6ded7a061f96a73896db6be17a6582f09a63a6040040919.js integrity="sha256-tvgHF7xozTi23tegYflqc4lttr4XplgvCaY6YEAECRk="></script><script async src=/js/search-modal.4e30271fef6fac86c3b4143167e9784bd3f7037ce1045d03a321e7e799e91476.js integrity="sha256-TjAnH+9vrIbDtBQxZ+l4S9P3A3zhBF0DoyHn55npFHY="></script></body></html>